// Compiled file - any changes will be overwritten by grunt task
var ReviewsFilters={filters_data:{},remote_data:{},ajax_url:MakeReviews.ajax_url,ajax_action:MakeReviews.ajax_action,post_id:MakeReviews.post_id,form_id:"#rf-filters-form",selected_class:".fl-filters-selected .fs-selected",selected:".fl-filters-selected",apply_button:"#filters-apply-btn",sort_apply_button:"#sort-apply-btn",no_results:".no-results",items:".reviews-items",item:".reviews-item",model:".reviews-item.reviews-model",sort_form_id:"#rl-sort-form",sortby:"most_recent",order:"desc",loading_class:"filters-loading"};!function($,filters){"use strict";filters.update_records=function(){$(filters.item+":visible").remove(),filters.remote_data.length?($(filters.no_results).hide(),$("#count").html("("+filters.remote_data.length+")"),$.each(filters.remote_data,function(i,v){var row=$(filters.model).clone();if(row.removeClass("reviews-model"),row.find(".ri-item-title").html(v.title),row.find(".ri-item-subtitle").html(v.subtitle),row.find(".ri-score-price").find(".ri-price span").html(v.price.replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")),v.most_recent){var date=new Date(v.most_recent),formattedDate=date.getMonth()+1+"/"+date.getDate()+"/"+date.getFullYear();row.find(".ri-date").html(formattedDate)}row.find(".ri-type").html(v.type),row.find(".ri-score-price").find(".ri-score span").html(v.score+"%"),v.buy_url&&(row.find(".ri-score-price").find(".ri-buy-now a").attr("href",v.buy_url),row.find(".ri-score-price").find(".ri-buy-now").show().css("display","flex")),row.find(".ri-feature-image a").css("background-image","url("+v.thumbnail+")"),row.find(".ri-link").attr("href",v.link),v.winner&&(row.find(".ri-item-meta").append(v.winner),row.addClass("winner")),$(filters.items).append(row)})):$(filters.no_results).show()},filters.update=function(){sessionStorage.setItem("filters_data",JSON.stringify(filters.filters_data)),filters._update_selected_filter_list(),filters._update_from_remote()},filters.reset=function(){filters.filters_data=[],filters.update()},filters.form_change=function(){var data={},form=$(filters.form_id);$.each(form.serializeArray(),function(i,field){data[field.name]||(data[field.name]=[]),data[field.name].push(field.value)}),filters.filters_data=data,filters.update()},filters.delete_selected_filter=function(){var button=$(this),option=button.attr("data-option"),value=button.attr("data-value");$('input[name="'+option+'"][value="'+value+'"]').attr("checked",!1);var index=filters.filters_data[option].indexOf(value);filters.filters_data[option].splice(index,1),filters.filters_data[option].length||delete filters.filters_data[option],filters.update()},filters.sort_change=function(){var descSorted=!1;return descSorted=!(!$(this).children().is("#recent")&&!$(this).children().is("#score")||!$(this).hasClass("dsc"))||!(!$(this).children().is("#az")&&!$(this).children().is("#price")||!$(this).hasClass("asc")),$(filters.sort_form_id+" .rl-sort-choice").removeClass("asc"),$(filters.sort_form_id+" .rl-sort-choice").removeClass("dsc"),0==descSorted?$(this).children().is("#recent")||$(this).children().is("#score")?($(this).removeClass("asc"),$(this).addClass("dsc"),filters.order="dsc"):($(this).removeClass("dsc"),$(this).addClass("asc"),filters.order="asc"):$(this).children().is("#recent")||$(this).children().is("#score")?($(this).removeClass("dsc"),$(this).addClass("asc"),filters.order="asc"):($(this).removeClass("asc"),$(this).addClass("dsc"),filters.order="dsc"),filters.sortby=$(this).find(":input").val(),sessionStorage.setItem("sort",filters.sortby),filters._update_from_remote(),!1},filters._update_selected_filter_list=function(){var container=$(filters.selected_class);container.empty();var callback=function(_,v){var option_name=$('input[name="'+item+'"][value="'+v+'"]').parent().find("span").html();container.append($("<button>").addClass("fs-selected-btn btn btn-link").attr("data-option",item).attr("data-value",v).html('<i class="fa fa-times"></i>'+option_name))};if(Object.keys(filters.filters_data).length){for(var item in filters.filters_data)filters.filters_data.hasOwnProperty(item)&&$.each(filters.filters_data[item],callback);container.parent().show()}else container.parent().hide()},filters._update_from_remote=function(){var opts={action:"reviews-filters",post_id:filters.post_id,filters:filters.filters_data,sort:filters.sortby,order:filters.order};$("body").addClass(filters.loading_class),$.post(filters.ajax_url,opts,function(response){response.success&&(filters.remote_data=response.data,filters.update_records()),$("body").removeClass(filters.loading_class)})},filters.load_stored_data=function(){var stored_filters=sessionStorage.getItem("filters_data");stored_filters&&(filters.filters_data=JSON.parse(stored_filters));var stored_sort=sessionStorage.getItem("sort");stored_sort&&(filters.sortby=stored_sort,$('input[name="sort"][value="'+stored_sort+'"]').attr("checked",!0))},$(document).ready(function(){$(filters.sort_form_id+" span.rl-sort-choice").on("click",filters.sort_change),$(filters.form_id+" :input").on("change",filters.form_change),$(filters.form_id).on("reset",filters.reset),$(filters.selected_class).on("click","button",filters.delete_selected_filter),$(filters.apply_button).on("click",function(e){e.preventDefault(),e.stopPropagation(),filters.update(),$("#show-filters-btn").click()}),$(filters.sort_apply_button).on("click",function(e){e.preventDefault(),e.stopPropagation(),filters.update()}),filters.load_stored_data(),"desc"==filters.order?$(filters.sort_form_id+" ."+filters.sortby+" .rl-sort-choice").addClass("dsc"):$(filters.sort_form_id+" ."+filters.sortby+" .rl-sort-choice").addClass("asc"),filters.update()})}(jQuery,ReviewsFilters),jQuery(document).ready(function($){$("#rf-filters-form").length&&$("#rf-filters-form")[0].reset(),$(".fl-filter .dropdown-toggle").dropdown(),$("#show-filters-btn").click(function(){"true"===$(this).attr("aria-expanded")?($("html").removeClass("filters-open"),$(this).attr("aria-expanded","false")):($("html").addClass("filters-open"),$(this).attr("aria-expanded","true"))}),$("#filters-cancel-btn").click(function(){$("html").removeClass("filters-open"),$("#show-filters-btn").attr("aria-expanded","false")}),$("#rf-reset-btn").click(function(){$("#rf-filters-form")[0].reset()}),$("#reviews-nav-btn").click(function(e){e.preventDefault(),$("html").toggleClass("review-nav-open")}),$("#virtual-placeholder").click(function(){$(this).fadeOut(),$(".virtual-tour .webrotate360").addClass("show")}),$("#compare").hasClass("active")&&$("#category-picker").click(function(e){e.preventDefault(),$("#category-dropdown").toggle()}),$("#category-dropdown").html()&&""!=$("#category-dropdown").html()||(console.log("test"),$("#category-picker").css("pointer-events","none"))});